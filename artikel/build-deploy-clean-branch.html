<!doctype html>
<html lang="id">
<head>
  <!-- Encoding & viewport -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title & description -->
  <title>Build and Deploy to Clean Branch — Alur Dibalik + Cek Perubahan Sebelum rsync ⚠️</title>
  <meta name="description" content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai.">

  <!-- Canonical & page metadata -->
  <link rel="canonical" href="https://frijal.pages.dev/artikel/build-deploy-clean-branch.html">
  <meta name="author" content="Fakhrul">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#10131A">

  <!-- Favicons (sesuaikan path di proyekmu) -->
  <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <!-- Open Graph -->
  <meta property="og:title" content="⚠️ Build and Deploy to Clean Branch — Alur Dibalik + Cek Perubahan Sebelum rsync">
  <meta property="og:description" content="Balik alur deploy: bandingkan dulu isi daftar file yang diizinkan dengan branch site. Kalau ada perubahan, baru rsync + deploy.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://frijal.pages.dev/artikel/build-deploy-clean-branch.html">
  <meta property="og:image" content="https://frijal.pages.dev/img/build-deploy-clean-branch.webp">
  <meta property="og:site_name" content="Frijal Docs">
  <meta property="article:section" content="DevOps">
  <meta property="article:author" content="Fakhrul">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="⚠️ Build and Deploy to Clean Branch — Alur Dibalik + Cek Perubahan Sebelum rsync">
  <meta name="twitter:description" content="Bandingkan dulu, deploy kemudian. Workflow aman, bersih, dan efisien dengan rsync --dry-run.">
  <meta name="twitter:image" content="https://frijal.pages.dev/img/build-deploy-clean-branch.webp">
  <meta name="twitter:site" content="@frijal">
  <meta name="twitter:creator" content="@frijal">

  <!-- Structured data (JSON-LD) untuk SEO -->
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"TechArticle","headline":"Build and Deploy to Clean Branch — Alur Dibalik + Cek Perubahan Sebelum rsync","description":"Workflow GitHub Actions yang membandingkan perubahan sebelum rsync dan deploy ke branch site, plus penjelasan dan YAML siap pakai.","author":{"@type":"Person","name":"Fakhrul","image":"https://frijal.pages.dev/img/build-deploy-clean-branch.webp"},"publisher":{"@type":"Organization","name":"Frijal Docs","logo":{"@type":"ImageObject","url":"https://frijal.pages.dev/icon.png","image":"https://frijal.pages.dev/img/build-deploy-clean-branch.webp"},"image":"https://frijal.pages.dev/img/build-deploy-clean-branch.webp"},"datePublished":"2025-10-22","dateModified":"2025-10-22","mainEntityOfPage":{"@type":"WebPage","@id":"https://frijal.pages.dev/artikel/build-deploy-clean-branch.html","image":"https://frijal.pages.dev/img/build-deploy-clean-branch.webp"},"image":"https://frijal.pages.dev/img/build-deploy-clean-branch.webp"}</script>

  <!-- Widescreen + Mobile-friendly CSS -->
  <style>
    :root {
      --bg: #0B0F16;
      --panel: #121826;
      --text: #E6EAF2;
      --muted: #A7B0C0;
      --accent: #6EE7B7;
      --accent-2: #60A5FA;
      --danger: #F59E0B;
      --code-bg: #0F172A;
      --code-border: #1F2937;
      --link: #93C5FD;
      --maxw: 1080px; /* widescreen content width */
    }

    html, body {
      height: 100%;
      background: radial-gradient(1200px 600px at 60% -10%, #121826 20%, #0B0F16 70%);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.65;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .wrap {
      display: grid;
      grid-template-columns: 1fr minmax(0, var(--maxw)) 1fr;
    }
    .content {
      grid-column: 2;
      padding: 24px;
    }

    header.hero {
      margin: 24px 0 12px;
      padding: 24px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(17,24,39,0.7), rgba(17,24,39,0.35));
      border: 1px solid rgba(255,255,255,0.06);
    }

    .title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: clamp(1.25rem, 1.6vw + 1rem, 2rem);
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .title .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(245, 158, 11, 0.15);
      color: var(--danger);
      font-weight: 600;
      border: 1px dashed rgba(245, 158, 11, 0.45);
    }

    .subtitle {
      margin-top: 10px;
      color: var(--muted);
      font-size: 0.98rem;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 12px;
      background: var(--panel);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.08);
      cursor: pointer;
      transition: transform .08s ease, background .2s ease;
      user-select: none;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    .grid {
      display: grid;
      grid-template-columns: 1.08fr 0.92fr;
      gap: 16px;
      margin-top: 18px;
    }

    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
    }

    section.block {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 18px;
    }

    h2, h3 {
      margin: 8px 0 14px;
      font-weight: 700;
      letter-spacing: .2px;
    }
    h2 { font-size: 1.25rem; }
    h3 { font-size: 1.1rem; }

    .lead { color: var(--muted); }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 10px;
    }

    .list > li {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      padding: 12px;
    }

    .code {
      background: var(--code-bg);
      border: 1px solid var(--code-border);
      border-radius: 14px;
      overflow: auto;
      position: relative;
    }

    pre {
      margin: 0;
      padding: 16px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95rem;
      line-height: 1.55;
      color: #D1D5DB;
    }

    .codebar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.2);
      border-top-left-radius: 14px;
      border-top-right-radius: 14px;
    }

    .code-actions {
      display: inline-flex;
      gap: 8px;
    }

    .note {
      margin-top: 12px;
      color: var(--muted);
      font-size: 0.94rem;
    }

    footer.site {
      margin: 24px 0;
      padding: 18px;
      color: var(--muted);
      font-size: 0.9rem;
      border-top: 1px dashed rgba(255,255,255,0.1);
    }

    .share {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .share a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.04);
    }
    .share svg {
      width: 18px; height: 18px;
    }

    .kbd {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 6px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      font-size: .9rem;
    }

    /* Fullscreen utilities */
    .fullscreen {
      position: fixed;
      inset: 0;
      z-index: 9999;
      backdrop-filter: blur(2px);
      padding: 24px;
      background: radial-gradient(1200px 600px at 60% -10%, #121826 20%, #0B0F16 70%);
      overflow: auto;
    }
  </style>
<meta property="og:image:alt" content="Build and Deploy to Clean Branch — Alur Dibalik + Cek Perubahan Sebelum rsync ⚠️">
  <meta itemprop="image" content="https://frijal.pages.dev/img/build-deploy-clean-branch.webp">
<link rel="stylesheet" href="/ext/marquee-url.css"><link rel="alternate" type="application/rss+xml" title="30 artikel baru bikin." href="https://frijal.pages.dev/rss.xml" />
    <meta property="article:published_time" content="2025-10-22T11:53:56.613+00:00">
</head>
<body>
  <div class="wrap">
    <main class="content">
      <header class="hero">
        <div class="title">
          <span class="badge">⚠️ Build and Deploy to Clean Branch</span>
          <span>Alur Dibalik: cek perubahan dulu, baru rsync + deploy</span>
<h1></h1>
<div id="iposbrowser"></div>
        </div>
        <p class="subtitle">
          Intinya: sebelum melakukan <span class="kbd">rsync</span> dan deploy, workflow ini membandingkan isi daftar file yang diizinkan dengan versi sebelumnya di branch <span class="kbd">site</span>. Kalau tidak ada perubahan, langkah <span class="kbd">rsync</span> dan deploy dilewati.
        </p>
        <div class="actions">
          <button class="btn" id="toggleFull">Full screen</button>
          <button class="btn" id="copyTitle">Salin judul</button>
          <button class="btn" id="scrollCode">Lompat ke kode</button>
        </div>
      </header>

      <div class="grid">
        <section class="block">
          <h2>Konsep alur yang dibalik</h2>
          <ul class="list">
            <li><strong>Inti:</strong> Cek perubahan dulu. Bandingkan hasil seleksi file dari branch <span class="kbd">main</span> dengan isi branch <span class="kbd">site</span>.</li>
            <li><strong>Langkah 1:</strong> Checkout <span class="kbd">main</span> sebagai sumber, dan <span class="kbd">site</span> sebagai target.</li>
            <li><strong>Langkah 2:</strong> Ekstrak file terizinkan ke direktori sementara (<span class="kbd">deploy_dir</span>).</li>
            <li><strong>Langkah 3:</strong> Gunakan <span class="kbd">rsync --dry-run</span> untuk membandingkan <span class="kbd">deploy_dir</span> vs <span class="kbd">site</span>.</li>
            <li><strong>Keputusan:</strong> Jika ada perubahan → lanjutkan rsync + deploy. Jika tidak → skip deploy.</li>
          </ul>
          <p class="lead">Pendekatan ini menghemat waktu, mengurangi commit “kosong”, dan menjaga branch <span class="kbd">site</span> tetap bersih dan akurat.</p>
        </section>

        <section class="block">
          <h2>Tips praktis biar workflow makin mantap</h2>
          <ul class="list">
            <li><strong>Logging:</strong> Simpan hasil perbandingan ke <span class="kbd">diff.log</span> dan upload sebagai artifact agar gampang audit.</li>
            <li><strong>Ekstensi file:</strong> Pastikan pola <span class="kbd">--include</span> konsisten dengan kebutuhanmu (HTML, XML, TXT, ikon, manifest).</li>
            <li><strong>Kebersihan:</strong> Gunakan <span class="kbd">--delete</span> untuk memastikan target selalu mirror dari sumber terpilih.</li>
            <li><strong>Stabilitas:</strong> Tetap pakai <span class="kbd">actions/checkout@v4</span> dua kali: sekali untuk <span class="kbd">main</span>, sekali untuk <span class="kbd">site</span>.</li>
            <li><strong>Ekstra aman:</strong> Jika ada build step, jalankan sebelum seleksi file, supaya yang dibandingkan sudah final.</li>
          </ul>
        </section>
      </div>

      <section class="block" id="codeBlock">
        <div class="codebar">
          <strong>Contoh implementasi (YAML)</strong>
          <div class="code-actions">
            <button class="btn" id="copyCode">Salin kode</button>
            <button class="btn" id="wideCode">Lebarkan area kode</button>
          </div>
        </div>
        <div class="code" id="codePane">
<pre><code>name: ⚠️ Build and Deploy to Clean Branch

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout branch main (source)
      - name: Checkout source branch
        uses: actions/checkout@v4
        with:
          ref: main
          path: source

      # Checkout branch site (target)
      - name: Checkout site branch
        uses: actions/checkout@v4
        with:
          ref: site
          path: site

      # Buat direktori sementara
      - name: Create clean directory
        run: mkdir deploy_dir

      # Salin hanya file yang diizinkan dari source
      - name: Sync allowed files to deploy directory
        run: |
          rsync -a --delete \
            --include='artikel/***' \
            --include='ext/***' \
            --include='img/***' \
            --include='artikel.json' \
            --include='_redirects' \
            --include='_headers' \
            --include='*.html' \
            --include='*.xml' \
            --include='*.txt' \
            --include='favicon.*' \
            --include='icon.*' \
            --include='logo.*' \
            --include='thumbnail.*' \
            --include='*.webmanifest' \
            --exclude='*' \
            source/ deploy_dir/

      # Bandingkan dengan branch site
      - name: Check for changes
        id: check_changes
        run: |
          rsync -a --dry-run --delete deploy_dir/ site/ > diff.log
          if [ -s diff.log ]; then
            echo "changed=true" &gt;&gt; $GITHUB_OUTPUT
          else
            echo "changed=false" &gt;&gt; $GITHUB_OUTPUT
          fi

      # [Opsional] Upload diff.log untuk audit
      - name: Upload diff artifact
        if: steps.check_changes.outputs.changed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: deploy-diff
          path: diff.log

      # Deploy hanya jika ada perubahan
      - name: Deploy to site branch
        if: steps.check_changes.outputs.changed == 'true'
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy_dir
          publish_branch: site
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          force_orphan: true
</code></pre>
        </div>
        <p class="note">Kalau kamu ingin lebih ketat, tambahkan validasi checksum (misalnya dengan <span class="kbd">sha256sum</span>) untuk mendeteksi perubahan yang halus.</p>
      </section>

      <section class="block">
        <h2>Penjelasan singkat dan alasan desain</h2>
        <ul class="list">
          <li><strong>Checkout dua cabang:</strong> Kita butuh snapshot <span class="kbd">main</span> (sumber) dan <span class="kbd">site</span> (target) agar bisa membandingkan keadaan terakhir yang ter-deploy.</li>
          <li><strong>Seleksi file:</strong> <span class="kbd">rsync</span> dengan kombinasi <span class="kbd">--include</span>/<span class="kbd">--exclude</span> membuat direktori bersih (<span class="kbd">deploy_dir</span>) berisi hanya file yang “diizinkan”.</li>
          <li><strong>Dry-run:</strong> <span class="kbd">rsync --dry-run --delete</span> menghasilkan daftar perubahan tanpa benar-benar menyalin; jika ada isi <span class="kbd">diff.log</span>, berarti perlu deploy.</li>
          <li><strong>Conditional deploy:</strong> Langkah deploy memakai kondisi <span class="kbd">if</span> sehingga hanya berjalan bila ada perbedaan; ini mencegah commit kosong.</li>
          <li><strong>Artifact:</strong> Opsi upload <span class="kbd">diff.log</span> membantu audit dan debugging—praktis kalau suatu saat hasil tidak sesuai ekspektasi.</li>
        </ul>
      </section>

      <section class="block">
        <h2>Opsi lanjutan dan penguatan</h2>
        <ul class="list">
          <li><strong>Proteksi pola:</strong> Simpan pola <span class="kbd">include/exclude</span> di file terpisah (misalnya <span class="kbd">sync.rules</span>) dan panggil dengan <span class="kbd">--filter='merge sync.rules'</span> agar mudah dirawat.</li>
          <li><strong>Pre-build:</strong> Jika ada proses build (minify, generate, bundling), jalankan sebelum seleksi agar yang dibandingkan benar-benar output final.</li>
          <li><strong>Cache:</strong> Tambah caching untuk dependency build agar job makin cepat, tanpa mengubah mekanisme cek perubahan.</li>
          <li><strong>Notifikasi:</strong> Kirim notifikasi (mis. ke Slack) hanya saat <span class="kbd">changed == true</span> supaya tim dapat sinyal relevan.</li>
          <li><strong>Keamanan:</strong> Pastikan tidak ada file sensitif yang lolos: validasi dengan skrip audit (regex nama file, ekstensi, path).</li>
        </ul>
        <div id="disqus_thread"></div>
      </section>
      <footer class="site">
               <div style="margin-top:10px;">
          🄯 2025 Frijal Docs — Artikel DevOps. Canonical: <a href="https://frijal.pages.dev/artikel/build-deploy-clean-branch.html">frijal.pages.dev/artikel/build-deploy-clean-branch.html</a>
        </div>
      </footer>
    </main>
  </div>

  <!-- JavaScript ringan untuk interaksi -->
  <script>
    (function() {
      const canonical = document.querySelector('link[rel="canonical"]')?.href || location.href;
      const title = document.title;

      // Fullscreen toggle
      const wrap = document.querySelector('.wrap');
      const content = document.querySelector('.content');
      const toggleFull = document.getElementById('toggleFull');
      let isFull = false;
      toggleFull.addEventListener('click', () => {
        isFull = !isFull;
        if (isFull) {
          content.classList.add('fullscreen');
          toggleFull.textContent = 'Keluar full screen';
        } else {
          content.classList.remove('fullscreen');
          toggleFull.textContent = 'Full screen';
        }
      });

      // Scroll to code
      document.getElementById('scrollCode').addEventListener('click', () => {
        document.getElementById('codeBlock').scrollIntoView({ behavior: 'smooth', block: 'start' });
      });

      // Copy code
      const codeEl = document.querySelector('#codeBlock pre');
      document.getElementById('copyCode').addEventListener('click', () => {
        const text = codeEl.innerText;
        navigator.clipboard.writeText(text).then(() => {
          const btn = document.getElementById('copyCode');
          btn.textContent = 'Kode disalin';
          setTimeout(() => btn.textContent = 'Salin kode', 1600);
        });
      });

      // Widen code pane
      const codePane = document.getElementById('codePane');
      const wideBtn = document.getElementById('wideCode');
      let wide = false;
      wideBtn.addEventListener('click', () => {
        wide = !wide;
        codePane.style.maxWidth = wide ? 'none' : '';
        codePane.style.width = wide ? '100%' : '';
        wideBtn.textContent = wide ? 'Kembalikan lebar' : 'Lebarkan area kode';
      });
    })();
  </script>
<div class="search-floating-container"><input type="text" id="floatingSearchInput" placeholder="cari artikel..." autocomplete="off"><span id="floatingSearchClear" class="clear-button"></span><div id="floatingSearchResults" class="floating-results-container"></div></div>
<section id="related-marquee-section"><div id="related-marquee-container"></div></section><script defer src="/ext/marquee-url.js"></script>
<script defer src="/ext/iposbrowser.js"></script><script defer src="/ext/markdown.js"></script><script defer src="/ext/disqus.js"></script>
</body>
</html>
