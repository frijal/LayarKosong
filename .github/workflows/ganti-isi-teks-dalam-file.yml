name: "ðŸš€ Mass Replace via Sed"

on:
  workflow_dispatch:
    inputs:
      search_text:
        description: "Teks yang dicari"
        required: true
      replace_text:
        description: "Teks pengganti"
        required: true
      folder:
        description: "Lokasi folder (default: .)"
        required: false
        default: "."

permissions:
  contents: write
  pull-requests: write

jobs:
  replace:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

      - name: Run Fast Replacement
        shell: bash
        run: |
          SEARCH="${{ github.event.inputs.search_text }}"
          REPLACE="${{ github.event.inputs.replace_text }}"
          TARGET="${{ github.event.inputs.folder }}"
          
          echo "ðŸ” Mencari: $SEARCH di folder $TARGET"
          
          # Menggunakan find untuk mencari file dan sed untuk mengganti teksnya
          # Kita kecualikan folder .git dan node_modules agar tidak berat
          find "$TARGET" -type f -not -path '*/.*' -not -path '*/node_modules/*' -not -path '*/functions/*' -not -path '*/img/*' -exec sed -i "s|$SEARCH|$REPLACE|g" {} +

      - name: "Check Git Status"
        id: status
        run: |
          if [[ -n "$(git status --porcelain)" ]]; then
            echo "changed=true" >> $GITHUB_OUTPUT
          else
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "::notice::Tidak ada perubahan yang ditemukan."
          fi

      - name: "Create Pull Request"
        if: steps.status.outputs.changed == 'true'
        uses: peter-evans/create-pull-request@c5a7806660adbe173f04e3e038b0ccdcd758773c # v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: mass replace via sed"
          branch: "automation/sed-replace-${{ github.run_id }}"
          title: "Mass Replace: ${{ github.event.inputs.search_text }}"
          body: "Automated replacement using `sed` command."
