name: Generate Layar Kosong AI API (Manual/Scheduled)

on:
  workflow_dispatch:
  schedule:
    - cron: "0 19 * * *" 

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
    - name: Checkout Repository Code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Node.js Environment
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    # 3. Instal Dependencies (Menggunakan package.json)
    # Langkah ini akan menginstal Cheerio secara otomatis
    - name: Install Node Dependencies
      run: npm install 

    # 4. Jalankan Skrip API Generator (Script sudah ESM)
    - name: Run AI API Generator Script
      run: node ext/generate-ai-api.js 

    # 5. Commit dan Push File JSON yang Baru Dibuat (Menggunakan 'file_pattern')
    - name: Commit & Push Generated API Files
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        # Mengatasi warning sebelumnya
        file_pattern: 'api/v1/' 
        commit_message: "ðŸ¤– CI: Generate and update AI API files"
        branch: ${{ github.ref_name }}
