name: ğŸŒ Ping All Feed Sitemap

on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * *' # otomatis setiap hari jam 06:00 UTC (13:00 WIB)
  push:
    paths:
      - 'feed-*.xml'
      - 'rss.xml'
      - 'sitemap.xml'

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Ping feeds and sitemap to search engines
        run: |
          DOMAIN="https://frijal.pages.dev"
          INDEXNOW_KEY="f8399d60e90d46a6945577b73ff3f778"

          # Gabungkan semua XML (feed + sitemap)
          FILES=$(ls feed-*.xml rss.xml sitemap.xml | sed "s|^|${DOMAIN}/|")

          for URL in $FILES; do
            echo "ğŸ”” Mem-ping: $URL"

            # ğŸŒ Pingomatic
            curl -s "https://pingomatic.com/ping/?title=Frijal+Feed&blogurl=${URL}&rssurl=${URL}" || true

            # ğŸ”¥ FeedBurner
            curl -s "https://feedburner.google.com/fb/a/pingSubmit?bloglink=${URL}" || true

            # ğŸ”— Twingly
            curl -s -d "url=${URL}" https://rpc.twingly.com/ || true

            # ğŸ“° Weblogs.com
            curl -s -d "name=Frijal&url=${URL}" http://rpc.weblogs.com/RPC2 || true

            # âš¡ IndexNow (Bing, Yandex, Naver, Seznam)
            curl -s "https://api.indexnow.org/indexnow?url=${URL}&key=${INDEXNOW_KEY}" || true

            # ğŸ” Bing Webmaster Ping
            curl -s "https://www.bing.com/ping?sitemap=${URL}" || true

            # ğŸ§­ Google Blog Search ping
            curl -s "https://blogsearch.google.com/ping?blogurl=${URL}" || true

            # ğŸ” Google Search ping khusus untuk sitemap
            if [[ "$URL" == *"sitemap.xml" ]]; then
              curl -s "https://www.google.com/ping?sitemap=${URL}" || true
            fi

            echo "âœ… Ping selesai untuk: $URL"
            echo "---------------------------------------------"
          done

          echo "ğŸ‰ Semua feed dan sitemap sukses diping!"
