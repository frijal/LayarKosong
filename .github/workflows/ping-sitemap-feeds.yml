name: üåç Ping All Feed Sitemap

on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * *' # otomatis setiap hari jam 06:00 UTC (13:00 WIB)
  push:
    paths:
      - 'feed-*.xml'
      - 'rss.xml'
      - 'sitemap.xml'

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Ping feeds and sitemap to search engines
        run: |
          DOMAIN="https://frijal.pages.dev"
          INDEXNOW_KEY="f8399d60e90d46a6945577b73ff3f778"

          FILES=$(ls feed-*.xml rss.xml sitemap.xml | sed "s|^|${DOMAIN}/|")

          for URL in $FILES; do
            echo "üîî Mem-ping: $URL"

          curl -s "https://pingomatic.com/ping/?title=Frijal+Feed&blogurl=${URL}&rssurl=${URL}" || true
          curl -s "https://feedburner.google.com/fb/a/pingSubmit?bloglink=${URL}" || true
          curl -s -d "url=${URL}" https://rpc.twingly.com/ || true
          curl -s -d "name=Frijal&url=${URL}" http://rpc.weblogs.com/RPC2 || true
          curl -s "https://api.indexnow.org/indexnow?url=${URL}&key=${INDEXNOW_KEY}" || true
          curl -s "https://www.bing.com/ping?sitemap=${URL}" || true

          sleep 5
            echo "‚úÖ Ping selesai untuk: $URL"
          done

            echo "üéâ Semua feed & sitemap sukses dikirim ke mesin pencari modern!"
