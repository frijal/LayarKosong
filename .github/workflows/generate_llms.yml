name: ðŸ¤– Auto-Generate LLMs.txt

on:
  # Jalankan setiap hari (contoh: Pukul 02:00 UTC)
  schedule:
    - cron: '0 2 * * *'
  # Memungkinkan untuk menjalankan secara manual dari GitHub UI
  workflow_dispatch:

jobs:
  generate_and_commit:
    runs-on: ubuntu-latest
    
    # Penting: Beri izin (permissions) write pada contents agar bot bisa commit/push
    permissions:
      contents: write 

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies (hanya yang diperlukan)
        # ðŸ”¥ Hapus requests, beautifulsoup4, dan html2text. Hanya perlu tool dasar (requests untuk file statis masih perlu, jadi kita biarkan saja kalau nanti ada perubahan, tapi kita hapus yang tidak perlu).
        # Karena di script terakhir kita sudah hapus 'requests' dll, kita bisa hapus installasi ini!
        run: |
          python -m pip install --upgrade pip
          # Tidak perlu instalasi lain (requests, bs4, html2text) karena skrip sekarang beroperasi secara lokal.
          echo "Tidak ada instalasi dependencies tambahan."

      - name: Run LLMs file generation script
        # Pastikan ini adalah path yang benar ke generate_llms.py kamu
        run: python ext/generate_llms.py

      - name: Commit and Push generated files
        run: |
          # Konfigurasi identitas Bot
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          
          # ðŸ”¥ Hapus llms-full.txt dari git add karena skrip tidak lagi membuatnya.
          git add llms.txt
          
          # Cek apakah ada perubahan yang perlu di-commit
          # Perhatikan: git diff --staged tidak perlu tahu nama file spesifik jika file lain juga bisa ditambahkan.
          if git diff --staged --quiet; then
            echo "Tidak ada perubahan pada llms.txt. Melewati commit."
          else
            # ðŸ”¥ Pesan commit juga disesuaikan
            echo "Ada perubahan. Committing dan pushing..."
            git commit -m "ðŸ¤– Docs: Auto-generate llms.txt index"
            git push
            echo "âœ… Commit dan Push sukses!"
          fi
