name: Auto Post ke Patreon

on:
  workflow_dispatch:
  schedule:
    - cron: '0 1 * * *' # tiap hari jam 01:00 UTC (â‰ˆ 08:00 WIB)

jobs:
  post-patreon:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ðŸ“¦ Install dependencies
        run: |
          npm ci

      - name: ðŸš€ Jalankan script Patreon
        env:
          PATREON_ACCESS_TOKEN: ${{ secrets.PATREON_ACCESS_TOKEN }}
          PATREON_CAMPAIGN_ID: ${{ secrets.PATREON_CAMPAIGN_ID }}
        run: |
          node ext/post-to-patreon.js

      - name: ðŸ’¾ Commit database posted-patreon
        if: success()
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add mini/posted-patreon.txt
          git commit -m "chore(patreon): update posted articles" || echo "No changes"
          git push
