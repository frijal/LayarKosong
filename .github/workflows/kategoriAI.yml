name: Update Categories with Gemini AI

on:
  workflow_dispatch: # 100% Manual dari tab Actions

jobs:
  classify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Process Categories
        env:
          # Mengambil semua 12 secret API Key (0-11)
          GEMINI_KEYS: ${{ secrets.GEMINI_API_KEY }},${{ secrets.GEMINI_API_KEY2 }},${{ secrets.GEMINI_API_KEY3 }},${{ secrets.GEMINI_API_KEY4 }},${{ secrets.GEMINI_API_KEY5 }},${{ secrets.GEMINI_API_KEY6 }},${{ secrets.GEMINI_API_KEY7 }},${{ secrets.GEMINI_API_KEY8 }},${{ secrets.GEMINI_API_KEY9 }},${{ secrets.GEMINI_API_KEY10 }},${{ secrets.GEMINI_API_KEY11 }}
        run: node ext/kategoriAI.js

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: update titleToCategory.js via Gemini AI"
          branch: manual-ai-classification
          delete-branch: true
          title: "ðŸ¤– [MANUAL] Update Kategori via Gemini AI"
          body: |
            Workflow ini dijalankan secara manual melalui dispatch.
            AI telah memindai `artikel.json` dan menyusun kata kunci baru.
            Silakan tinjau perubahan di `ext/titleToCategory.js`.
          labels: |
            manual-trigger
            ai-processed
