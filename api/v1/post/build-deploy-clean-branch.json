{
  "id": "build-deploy-clean-branch",
  "slug": "build-deploy-clean-branch",
  "title": "Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è",
  "category": "üñ•Ô∏è Teknologi Web, AI & Umum",
  "published_at": "2025-10-22T11:53:56.613+00:00",
  "url": "https://dalam.web.id/artikel/build-deploy-clean-branch.html",
  "image": "https://dalam.web.id/img/build-deploy-clean-branch.webp",
  "content": {
    "text": "‚ö†Ô∏è Build and Deploy to Clean Branch Alur Dibalik: cek perubahan dulu, baru rsync + deploy Intinya: sebelum melakukan rsync dan deploy, workflow ini membandingkan isi daftar file yang diizinkan dengan versi sebelumnya di branch site. Kalau tidak ada perubahan, langkah rsync dan deploy dilewati. Full screen Salin judul Lompat ke kode Konsep alur yang dibalik Inti: Cek perubahan dulu. Bandingkan hasil seleksi file dari branch main dengan isi branch site. Langkah 1: Checkout main sebagai sumber, dan site sebagai target. Langkah 2: Ekstrak file terizinkan ke direktori sementara (deploy_dir). Langkah 3: Gunakan rsync --dry-run untuk membandingkan deploy_dir vs site. Keputusan: Jika ada perubahan ‚Üí lanjutkan rsync + deploy. Jika tidak ‚Üí skip deploy. Pendekatan ini menghemat waktu, mengurangi commit ‚Äúkosong‚Äù, dan menjaga branch site tetap bersih dan akurat. Tips praktis biar workflow makin mantap Logging: Simpan hasil perbandingan ke diff.log dan upload sebagai artifact agar gampang audit. Ekstensi file: Pastikan pola --include konsisten dengan kebutuhanmu (HTML, XML, TXT, ikon, manifest). Kebersihan: Gunakan --delete untuk memastikan target selalu mirror dari sumber terpilih. Stabilitas: Tetap pakai actions/checkout@v4 dua kali: sekali untuk main, sekali untuk site. Ekstra aman: Jika ada build step, jalankan sebelum seleksi file, supaya yang dibandingkan sudah final. Contoh implementasi (YAML) Salin kode Lebarkan area kode name: ‚ö†Ô∏è Build and Deploy to Clean Branch on: push: branches: - main workflow_dispatch: jobs: build-and-deploy: runs-on: ubuntu-latest steps: # Checkout branch main (source) - name: Checkout source branch uses: actions/checkout@v4 with: ref: main path: source # Checkout branch site (target) - name: Checkout site branch uses: actions/checkout@v4 with: ref: site path: site # Buat direktori sementara - name: Create clean directory run: mkdir deploy_dir # Salin hanya file yang diizinkan dari source - name: Sync allowed files to deploy directory run: | rsync -a --delete \\ --include='artikel/***' \\ --include='ext/***' \\ --include='img/***' \\ --include='artikel.json' \\ --include='_redirects' \\ --include='_headers' \\ --include='*.html' \\ --include='*.xml' \\ --include='*.txt' \\ --include='favicon.*' \\ --include='icon.*' \\ --include='logo.*' \\ --include='thumbnail.*' \\ --include='*.webmanifest' \\ --exclude='*' \\ source/ deploy_dir/ # Bandingkan dengan branch site - name: Check for changes id: check_changes run: | rsync -a --dry-run --delete deploy_dir/ site/ > diff.log if [ -s diff.log ]; then echo \"changed=true\" >> $GITHUB_OUTPUT else echo \"changed=false\" >> $GITHUB_OUTPUT fi # [Opsional] Upload diff.log untuk audit - name: Upload diff artifact if: steps.check_changes.outputs.changed == 'true' uses: actions/upload-artifact@v4 with: name: deploy-diff path: diff.log # Deploy hanya jika ada perubahan - name: Deploy to site branch if: steps.check_changes.outputs.changed == 'true' uses: peaceiris/actions-gh-pages@v4 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./deploy_dir publish_branch: site user_name: 'github-actions[bot]' user_email: 'github-actions[bot]@users.noreply.github.com' force_orphan: true Kalau kamu ingin lebih ketat, tambahkan validasi checksum (misalnya dengan sha256sum) untuk mendeteksi perubahan yang halus. Penjelasan singkat dan alasan desain Checkout dua cabang: Kita butuh snapshot main (sumber) dan site (target) agar bisa membandingkan keadaan terakhir yang ter-deploy. Seleksi file: rsync dengan kombinasi --include/--exclude membuat direktori bersih (deploy_dir) berisi hanya file yang ‚Äúdiizinkan‚Äù. Dry-run: rsync --dry-run --delete menghasilkan daftar perubahan tanpa benar-benar menyalin; jika ada isi diff.log, berarti perlu deploy. Conditional deploy: Langkah deploy memakai kondisi if sehingga hanya berjalan bila ada perbedaan; ini mencegah commit kosong. Artifact: Opsi upload diff.log membantu audit dan debugging‚Äîpraktis kalau suatu saat hasil tidak sesuai ekspektasi. Opsi lanjutan dan penguatan Proteksi pola: Simpan pola include/exclude di file terpisah (misalnya sync.rules) dan panggil dengan --filter='merge sync.rules' agar mudah dirawat. Pre-build: Jika ada proses build (minify, generate, bundling), jalankan sebelum seleksi agar yang dibandingkan benar-benar output final. Cache: Tambah caching untuk dependency build agar job makin cepat, tanpa mengubah mekanisme cek perubahan. Notifikasi: Kirim notifikasi (mis. ke Slack) hanya saat changed == true supaya tim dapat sinyal relevan. Keamanan: Pastikan tidak ada file sensitif yang lolos: validasi dengan skrip audit (regex nama file, ekstensi, path).",
    "html": "<div class=\"wrap\">\n    <main class=\"content\">\n      <header class=\"hero\">\n        <div class=\"title\">\n          <span class=\"badge\">‚ö†Ô∏è Build and Deploy to Clean Branch</span>\n          <span>Alur Dibalik: cek perubahan dulu, baru rsync + deploy</span>\n<h1></h1>\n\n        </div>\n        <p class=\"subtitle\">\n          Intinya: sebelum melakukan <span class=\"kbd\">rsync</span> dan deploy, workflow ini membandingkan isi daftar file yang diizinkan dengan versi sebelumnya di branch <span class=\"kbd\">site</span>. Kalau tidak ada perubahan, langkah <span class=\"kbd\">rsync</span> dan deploy dilewati.\n        </p>\n        <div class=\"actions\">\n          <button class=\"btn\" id=\"toggleFull\">Full screen</button>\n          <button class=\"btn\" id=\"copyTitle\">Salin judul</button>\n          <button class=\"btn\" id=\"scrollCode\">Lompat ke kode</button>\n        </div>\n      </header>\n\n      <div class=\"grid\">\n        <section class=\"block\">\n          <h2>Konsep alur yang dibalik</h2>\n          <ul class=\"list\">\n            <li><strong>Inti:</strong> Cek perubahan dulu. Bandingkan hasil seleksi file dari branch <span class=\"kbd\">main</span> dengan isi branch <span class=\"kbd\">site</span>.</li>\n            <li><strong>Langkah 1:</strong> Checkout <span class=\"kbd\">main</span> sebagai sumber, dan <span class=\"kbd\">site</span> sebagai target.</li>\n            <li><strong>Langkah 2:</strong> Ekstrak file terizinkan ke direktori sementara (<span class=\"kbd\">deploy_dir</span>).</li>\n            <li><strong>Langkah 3:</strong> Gunakan <span class=\"kbd\">rsync --dry-run</span> untuk membandingkan <span class=\"kbd\">deploy_dir</span> vs <span class=\"kbd\">site</span>.</li>\n            <li><strong>Keputusan:</strong> Jika ada perubahan ‚Üí lanjutkan rsync + deploy. Jika tidak ‚Üí skip deploy.</li>\n          </ul>\n          <p class=\"lead\">Pendekatan ini menghemat waktu, mengurangi commit ‚Äúkosong‚Äù, dan menjaga branch <span class=\"kbd\">site</span> tetap bersih dan akurat.</p>\n        </section>\n\n        <section class=\"block\">\n          <h2>Tips praktis biar workflow makin mantap</h2>\n          <ul class=\"list\">\n            <li><strong>Logging:</strong> Simpan hasil perbandingan ke <span class=\"kbd\">diff.log</span> dan upload sebagai artifact agar gampang audit.</li>\n            <li><strong>Ekstensi file:</strong> Pastikan pola <span class=\"kbd\">--include</span> konsisten dengan kebutuhanmu (HTML, XML, TXT, ikon, manifest).</li>\n            <li><strong>Kebersihan:</strong> Gunakan <span class=\"kbd\">--delete</span> untuk memastikan target selalu mirror dari sumber terpilih.</li>\n            <li><strong>Stabilitas:</strong> Tetap pakai <span class=\"kbd\">actions/checkout@v4</span> dua kali: sekali untuk <span class=\"kbd\">main</span>, sekali untuk <span class=\"kbd\">site</span>.</li>\n            <li><strong>Ekstra aman:</strong> Jika ada build step, jalankan sebelum seleksi file, supaya yang dibandingkan sudah final.</li>\n          </ul>\n        </section>\n      </div>\n\n      <section class=\"block\" id=\"codeBlock\">\n        <div class=\"codebar\">\n          <strong>Contoh implementasi (YAML)</strong>\n          <div class=\"code-actions\">\n            <button class=\"btn\" id=\"copyCode\">Salin kode</button>\n            <button class=\"btn\" id=\"wideCode\">Lebarkan area kode</button>\n          </div>\n        </div>\n        <div class=\"code\" id=\"codePane\">\n<pre><code>name: ‚ö†Ô∏è Build and Deploy to Clean Branch\n\non:\n  push:\n    branches:\n      - main\n  workflow_dispatch:\n\njobs:\n  build-and-deploy:\n    runs-on: ubuntu-latest\n\n    steps:\n      # Checkout branch main (source)\n      - name: Checkout source branch\n        uses: actions/checkout@v4\n        with:\n          ref: main\n          path: source\n\n      # Checkout branch site (target)\n      - name: Checkout site branch\n        uses: actions/checkout@v4\n        with:\n          ref: site\n          path: site\n\n      # Buat direktori sementara\n      - name: Create clean directory\n        run: mkdir deploy_dir\n\n      # Salin hanya file yang diizinkan dari source\n      - name: Sync allowed files to deploy directory\n        run: |\n          rsync -a --delete \\\n            --include='artikel/***' \\\n            --include='ext/***' \\\n            --include='img/***' \\\n            --include='artikel.json' \\\n            --include='_redirects' \\\n            --include='_headers' \\\n            --include='*.html' \\\n            --include='*.xml' \\\n            --include='*.txt' \\\n            --include='favicon.*' \\\n            --include='icon.*' \\\n            --include='logo.*' \\\n            --include='thumbnail.*' \\\n            --include='*.webmanifest' \\\n            --exclude='*' \\\n            source/ deploy_dir/\n\n      # Bandingkan dengan branch site\n      - name: Check for changes\n        id: check_changes\n        run: |\n          rsync -a --dry-run --delete deploy_dir/ site/ &gt; diff.log\n          if [ -s diff.log ]; then\n            echo \"changed=true\" &gt;&gt; $GITHUB_OUTPUT\n          else\n            echo \"changed=false\" &gt;&gt; $GITHUB_OUTPUT\n          fi\n\n      # [Opsional] Upload diff.log untuk audit\n      - name: Upload diff artifact\n        if: steps.check_changes.outputs.changed == 'true'\n        uses: actions/upload-artifact@v4\n        with:\n          name: deploy-diff\n          path: diff.log\n\n      # Deploy hanya jika ada perubahan\n      - name: Deploy to site branch\n        if: steps.check_changes.outputs.changed == 'true'\n        uses: peaceiris/actions-gh-pages@v4\n        with:\n          github_token: ${{ secrets.GITHUB_TOKEN }}\n          publish_dir: ./deploy_dir\n          publish_branch: site\n          user_name: 'github-actions[bot]'\n          user_email: 'github-actions[bot]@users.noreply.github.com'\n          force_orphan: true\n</code></pre>\n        </div>\n        <p class=\"note\">Kalau kamu ingin lebih ketat, tambahkan validasi checksum (misalnya dengan <span class=\"kbd\">sha256sum</span>) untuk mendeteksi perubahan yang halus.</p>\n      </section>\n\n      <section class=\"block\">\n        <h2>Penjelasan singkat dan alasan desain</h2>\n        <ul class=\"list\">\n          <li><strong>Checkout dua cabang:</strong> Kita butuh snapshot <span class=\"kbd\">main</span> (sumber) dan <span class=\"kbd\">site</span> (target) agar bisa membandingkan keadaan terakhir yang ter-deploy.</li>\n          <li><strong>Seleksi file:</strong> <span class=\"kbd\">rsync</span> dengan kombinasi <span class=\"kbd\">--include</span>/<span class=\"kbd\">--exclude</span> membuat direktori bersih (<span class=\"kbd\">deploy_dir</span>) berisi hanya file yang ‚Äúdiizinkan‚Äù.</li>\n          <li><strong>Dry-run:</strong> <span class=\"kbd\">rsync --dry-run --delete</span> menghasilkan daftar perubahan tanpa benar-benar menyalin; jika ada isi <span class=\"kbd\">diff.log</span>, berarti perlu deploy.</li>\n          <li><strong>Conditional deploy:</strong> Langkah deploy memakai kondisi <span class=\"kbd\">if</span> sehingga hanya berjalan bila ada perbedaan; ini mencegah commit kosong.</li>\n          <li><strong>Artifact:</strong> Opsi upload <span class=\"kbd\">diff.log</span> membantu audit dan debugging‚Äîpraktis kalau suatu saat hasil tidak sesuai ekspektasi.</li>\n        </ul>\n      </section>\n\n      <section class=\"block\">\n        <h2>Opsi lanjutan dan penguatan</h2>\n        <ul class=\"list\">\n          <li><strong>Proteksi pola:</strong> Simpan pola <span class=\"kbd\">include/exclude</span> di file terpisah (misalnya <span class=\"kbd\">sync.rules</span>) dan panggil dengan <span class=\"kbd\">--filter='merge sync.rules'</span> agar mudah dirawat.</li>\n          <li><strong>Pre-build:</strong> Jika ada proses build (minify, generate, bundling), jalankan sebelum seleksi agar yang dibandingkan benar-benar output final.</li>\n          <li><strong>Cache:</strong> Tambah caching untuk dependency build agar job makin cepat, tanpa mengubah mekanisme cek perubahan.</li>\n          <li><strong>Notifikasi:</strong> Kirim notifikasi (mis. ke Slack) hanya saat <span class=\"kbd\">changed == true</span> supaya tim dapat sinyal relevan.</li>\n          <li><strong>Keamanan:</strong> Pastikan tidak ada file sensitif yang lolos: validasi dengan skrip audit (regex nama file, ekstensi, path).</li>\n        </ul>\n        \n      </section>\n      \n    </main>\n  </div>\n\n  <!-- JavaScript ringan untuk interaksi -->"
  },
  "meta": {
    "summary": "Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai.",
    "prompt_hint": "Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai.",
    "keywords": [],
    "topics": []
  }
}