<!doctypehtml><html prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#"lang=id><meta charset=utf-8><meta content=width=device-width,initial-scale=1,maximum-scale=1 name=viewport><title>Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è</title><link href=/apple-touch-icon.png rel=apple-touch-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://dalam.web.id#website","url":"https://dalam.web.id","name":"Layar Kosong","publisher":{"@type":"Organization","@id":"https://dalam.web.id#organization","name":"Layar Kosong","url":"https://dalam.web.id","logo":{"@type":"ImageObject","url":"https://dalam.web.id/logo.png","width":384,"height":384}}},{"@type":"Article","@id":"https://dalam.web.id/warta-tekno/build-deploy-clean-branch#article","isPartOf":{"@id":"https://dalam.web.id#website"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dalam.web.id/warta-tekno/build-deploy-clean-branch"},"license":"https://creativecommons.org/publicdomain/zero/1.0/","headline":"Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è","description":"Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai.","articleSection":"Warta Tekno","keywords":"alur, branch, build, clean, deploy, dibalik, layar kosong, perubahan, rsync, sebelum, warta tekno","image":{"@type":"ImageObject","url":"https://dalam.web.id/img/build-deploy-clean-branch.webp","width":1200,"height":675},"author":{"@type":"Person","name":"Fakhrul Rijal","url":"https://dalam.web.id/about"},"publisher":{"@id":"https://dalam.web.id#organization"},"datePublished":"2025-10-22T11:53:56.613+00:00","dateModified":"2025-10-22T11:53:56.613+00:00"},{"@type":"BreadcrumbList","@id":"https://dalam.web.id/warta-tekno/build-deploy-clean-branch#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Beranda","item":"https://dalam.web.id"},{"@type":"ListItem","position":2,"name":"Warta Tekno","item":"https://dalam.web.id/warta-tekno"},{"@type":"ListItem","position":3,"name":"Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è","item":"https://dalam.web.id/warta-tekno/build-deploy-clean-branch"}]}]}</script><style>:root{--bg:#0b0f16;--panel:#121826;--text:#e6eaf2;--muted:#a7b0c0;--accent:#6ee7b7;--accent-2:#60a5fa;--danger:#f59e0b;--code-bg:#0f172a;--code-border:#1f2937;--link:#93c5fd;--maxw:1080px}html,body{height:100%;color:var(--text);background:radial-gradient(1200px 600px at 60% -10%,#121826 20%,#0b0f16 70%);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Apple Color Emoji,Segoe UI Emoji;line-height:1.65}a{color:var(--link);text-decoration:none}a:hover{text-decoration:underline}.wrap{grid-template-columns:1fr minmax(0,var(--maxw))1fr;display:grid}.content{grid-column:2;padding:24px}header.hero{background:linear-gradient(#111827b3,#11182759);border:1px solid #ffffff0f;border-radius:18px;margin:24px 0 12px;padding:24px}.title{letter-spacing:.2px;align-items:center;gap:12px;font-size:clamp(1.25rem,1.6vw + 1rem,2rem);font-weight:700;display:flex}.title .badge{color:var(--danger);background:#f59e0b26;border:1px dashed #f59e0b73;border-radius:999px;align-items:center;gap:6px;padding:6px 10px;font-weight:600;display:inline-flex}.subtitle{color:var(--muted);margin-top:10px;font-size:.98rem}.actions{flex-wrap:wrap;gap:10px;margin-top:16px;display:flex}.btn{background:var(--panel);color:var(--text);cursor:pointer;user-select:none;border:1px solid #ffffff14;border-radius:12px;align-items:center;gap:8px;padding:10px 14px;transition:transform 80ms,background .2s;display:inline-flex}.btn:hover{transform:translateY(-1px)}.btn:active{transform:translateY(0)}.grid{grid-template-columns:1.08fr .92fr;gap:16px;margin-top:18px;display:grid}@media (width<=980px){.grid{grid-template-columns:1fr}}section.block{background:var(--panel);border:1px solid #ffffff0f;border-radius:16px;padding:18px}h2,h3{letter-spacing:.2px;margin:8px 0 14px;font-weight:700}h2{font-size:1.25rem}h3{font-size:1.1rem}.lead{color:var(--muted)}ul{gap:10px;margin:0;padding:0;list-style:none;display:grid}.list>li{background:#ffffff05;border:1px solid #ffffff0f;border-radius:12px;padding:12px}.code{background:var(--code-bg);border:1px solid var(--code-border);border-radius:14px;position:relative;overflow:auto}pre{color:#d1d5db;margin:0;padding:16px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:.95rem;line-height:1.55}.codebar{background:#0003;border-bottom:1px solid #ffffff0f;border-top-left-radius:14px;border-top-right-radius:14px;justify-content:space-between;align-items:center;gap:8px;padding:10px 12px;display:flex}.code-actions{gap:8px;display:inline-flex}.note{color:var(--muted);margin-top:12px;font-size:.94rem}footer.site{color:var(--muted);border-top:1px dashed #ffffff1a;margin:24px 0;padding:18px;font-size:.9rem}.share{flex-wrap:wrap;gap:10px;display:flex}.share a{background:#ffffff0a;border:1px solid #ffffff14;border-radius:10px;align-items:center;gap:8px;padding:8px 12px;display:inline-flex}.share svg{width:18px;height:18px}.kbd{background:#ffffff0f;border:1px solid #ffffff14;border-radius:6px;padding:2px 6px;font-size:.9rem;display:inline-block}.fullscreen{z-index:9999;backdrop-filter:blur(2px);background:radial-gradient(1200px 600px at 60% -10%,#121826 20%,#0b0f16 70%);padding:24px;position:fixed;inset:0;overflow:auto}</style><link href=/ext/marquee-url.css rel=stylesheet><link title="30 artikel baru bikin."href=https://dalam.web.id/rss.xml rel=alternate type=application/rss+xml><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai."name=ai:summary><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai."name=ai:prompt_hint><meta content=max-image-preview:large name=googlebot><meta content=#00b0ed name=theme-color><meta content=@frijal@mastodon.social name=fediverse:creator><meta content=@dalam.web.id name=bluesky:creator><meta content=175216696195384 property=fb:app_id><meta content=https://dalam.web.id/img/build-deploy-clean-branch.webp itemprop=image><meta content=id_ID property=og:locale><meta content="Layar Kosong"property=og:site_name><link href=/favicon.ico rel=icon><link href=https://dalam.web.id/warta-tekno/build-deploy-clean-branch rel=canonical><meta content=https://dalam.web.id/warta-tekno/build-deploy-clean-branch property=og:url><meta content="Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è"property=og:title><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai."name=description><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai."property=og:description><meta content="Fakhrul Rijal"name=author><meta content="index, follow, max-image-preview:large"name=robots><body><div class=wrap><main class=content><header class=hero><div class=title><span class=badge><h1>‚ö†Ô∏è Build and Deploy to Clean Branch</h1></span><span>Alur Dibalik: cek perubahan dulu, baru rsync + deploy</span><div id=iposbrowser></div></div><p class=subtitle>Intinya: sebelum melakukan <span class=kbd>rsync</span> dan deploy, workflow ini membandingkan isi daftar file yang diizinkan dengan versi sebelumnya di branch <span class=kbd>site</span>. Kalau tidak ada perubahan, langkah <span class=kbd>rsync</span> dan deploy dilewati.<div class=actions><button class=btn id=toggleFull>Full screen</button><button class=btn id=copyTitle>Salin judul</button><button class=btn id=scrollCode>Lompat ke kode</button></div></header><div class=grid><section class=block><h2>Konsep alur yang dibalik</h2><ul class=list><li>**Inti:** Cek perubahan dulu. Bandingkan hasil seleksi file dari branch <span class=kbd>main</span> dengan isi branch <span class=kbd>site</span>.<li>**Langkah 1:** Checkout <span class=kbd>main</span> sebagai sumber, dan <span class=kbd>site</span> sebagai target.<li>**Langkah 2:** Ekstrak file terizinkan ke direktori sementara (<span class=kbd>deploy_dir</span>).<li>**Langkah 3:** Gunakan <span class=kbd>rsync --dry-run</span> untuk membandingkan <span class=kbd>deploy_dir</span> vs <span class=kbd>site</span>.<li>**Keputusan:** Jika ada perubahan ‚Üí lanjutkan rsync + deploy. Jika tidak ‚Üí skip deploy.</ul><p class=lead>Pendekatan ini menghemat waktu, mengurangi commit ‚Äúkosong‚Äù, dan menjaga branch <span class=kbd>site</span> tetap bersih dan akurat.</section><section class=block><h2>Tips praktis biar workflow makin mantap</h2><ul class=list><li>**Logging:** Simpan hasil perbandingan ke <span class=kbd>diff.log</span> dan upload sebagai artifact agar gampang audit.<li>**Ekstensi file:** Pastikan pola <span class=kbd>--include</span> konsisten dengan kebutuhanmu (HTML, XML, TXT, ikon, manifest).<li>**Kebersihan:** Gunakan <span class=kbd>--delete</span> untuk memastikan target selalu mirror dari sumber terpilih.<li>**Stabilitas:** Tetap pakai <span class=kbd>actions/checkout@v4</span> dua kali: sekali untuk <span class=kbd>main</span>, sekali untuk <span class=kbd>site</span>.<li>**Ekstra aman:** Jika ada build step, jalankan sebelum seleksi file, supaya yang dibandingkan sudah final.</ul></section></div><section class=block id=codeBlock><div class=codebar>**Contoh implementasi (YAML)** <div class=code-actions><button class=btn id=copyCode>Salin kode</button><button class=btn id=wideCode>Lebarkan area kode</button></div></div><div class=code id=codePane><pre><code>name: ‚ö†Ô∏è Build and Deploy to Clean Branch
on:
  push:
    branches:
      - main
  workflow_dispatch:
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # Checkout branch main (source)
      - name: Checkout source branch
        uses: actions/checkout@v4
        with:
          ref: main
          path: source
      # Checkout branch site (target)
      - name: Checkout site branch
        uses: actions/checkout@v4
        with:
          ref: site
          path: site
      # Buat direktori sementara
      - name: Create clean directory
        run: mkdir deploy_dir
      # Salin hanya file yang diizinkan dari source
      - name: Sync allowed files to deploy directory
        run: |
          rsync -a --delete \
            --include='artikel/***' \
            --include='ext/***' \
            --include='img/***' \
            --include='artikel.json' \
            --include='_redirects' \
            --include='_headers' \
            --include='*.html' \
            --include='*.xml' \
            --include='*.txt' \
            --include='favicon.*' \
            --include='icon.*' \
            --include='logo.*' \
            --include='thumbnail.*' \
            --include='*.webmanifest' \
            --exclude='*' \
            source/ deploy_dir/
      # Bandingkan dengan branch site
      - name: Check for changes
        id: check_changes
        run: |
          rsync -a --dry-run --delete deploy_dir/ site/ > diff.log
          if [ -s diff.log ]; then
            echo "changed=true" >> $GITHUB_OUTPUT
          else
            echo "changed=false" >> $GITHUB_OUTPUT
          fi
      # [Opsional] Upload diff.log untuk audit
      - name: Upload diff artifact
        if: steps.check_changes.outputs.changed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: deploy-diff
          path: diff.log
      # Deploy hanya jika ada perubahan
      - name: Deploy to site branch
        if: steps.check_changes.outputs.changed == 'true'
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy_dir
          publish_branch: site
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          force_orphan: true
</code></pre></div><p class=note>Kalau kamu ingin lebih ketat, tambahkan validasi checksum (misalnya dengan <span class=kbd>sha256sum</span>) untuk mendeteksi perubahan yang halus.</section><section class=block><h2>Penjelasan singkat dan alasan desain</h2><ul class=list><li>**Checkout dua cabang:** Kita butuh snapshot <span class=kbd>main</span> (sumber) dan <span class=kbd>site</span> (target) agar bisa membandingkan keadaan terakhir yang ter-deploy.<li>**Seleksi file:** <span class=kbd>rsync</span> dengan kombinasi <span class=kbd>--include</span>/<span class=kbd>--exclude</span> membuat direktori bersih (<span class=kbd>deploy_dir</span>) berisi hanya file yang ‚Äúdiizinkan‚Äù.<li>**Dry-run:** <span class=kbd>rsync --dry-run --delete</span> menghasilkan daftar perubahan tanpa benar-benar menyalin; jika ada isi <span class=kbd>diff.log</span>, berarti perlu deploy.<li>**Conditional deploy:** Langkah deploy memakai kondisi <span class=kbd>if</span> sehingga hanya berjalan bila ada perbedaan; ini mencegah commit kosong.<li>**Artifact:** Opsi upload <span class=kbd>diff.log</span> membantu audit dan debugging‚Äîpraktis kalau suatu saat hasil tidak sesuai ekspektasi.</ul></section><section class=block><h2>Opsi lanjutan dan penguatan</h2><ul class=list><li>**Proteksi pola:** Simpan pola <span class=kbd>include/exclude</span> di file terpisah (misalnya <span class=kbd>sync.rules</span>) dan panggil dengan <span class=kbd>--filter='merge sync.rules'</span> agar mudah dirawat.<li>**Pre-build:** Jika ada proses build (minify, generate, bundling), jalankan sebelum seleksi agar yang dibandingkan benar-benar output final.<li>**Cache:** Tambah caching untuk dependency build agar job makin cepat, tanpa mengubah mekanisme cek perubahan.<li>**Notifikasi:** Kirim notifikasi (mis. ke Slack) hanya saat <span class=kbd>changed == true</span> supaya tim dapat sinyal relevan.<li>**Keamanan:** Pastikan tidak ada file sensitif yang lolos: validasi dengan skrip audit (regex nama file, ekstensi, path).</ul><div id=diskus></div><div id=related-articles-grid></div></section><footer class=site><div style=margin-top:10px>üÑØ 2025 Frijal Docs ‚Äî Artikel DevOps. Canonical: [dalam.web.id/artikel/build-deploy-clean-branch.html](https://dalam.web.id/warta-tekno/build-deploy-clean-branch.html)</div></footer></main></div><script>(function(){let canonical=document.querySelector(`link[rel="canonical"]`)?.href||location.href,title=document.title,wrap=document.querySelector(`.wrap`),content=document.querySelector(`.content`),toggleFull=document.getElementById(`toggleFull`),isFull=!1;toggleFull.addEventListener(`click`,()=>{isFull=!isFull,isFull?(content.classList.add(`fullscreen`),toggleFull.textContent=`Keluar full screen`):(content.classList.remove(`fullscreen`),toggleFull.textContent=`Full screen`)}),document.getElementById(`scrollCode`).addEventListener(`click`,()=>{document.getElementById(`codeBlock`).scrollIntoView({behavior:`smooth`,block:`start`})});let codeEl=document.querySelector(`#codeBlock pre`);document.getElementById(`copyCode`).addEventListener(`click`,()=>{let text=codeEl.innerText;navigator.clipboard.writeText(text).then(()=>{let btn=document.getElementById(`copyCode`);btn.textContent=`Kode disalin`,setTimeout(()=>btn.textContent=`Salin kode`,1600)})});let codePane=document.getElementById(`codePane`),wideBtn=document.getElementById(`wideCode`),wide=!1;wideBtn.addEventListener(`click`,()=>{wide=!wide,codePane.style.maxWidth=wide?`none`:``,codePane.style.width=wide?`100%`:``,wideBtn.textContent=wide?`Kembalikan lebar`:`Lebarkan area kode`})})();</script><div id=progress></div><a href=https://dalam.web.id/ id=layar-kosong-header></a><div class=search-floating-container><input placeholder="cari artikel..."autocomplete=off id=floatingSearchInput><span class=clear-button id=floatingSearchClear></span><div class=floating-results-container id=floatingSearchResults></div></div><div class=floating-nav id=dynamic-nav-container></div><div id=internal-nav></div><section id=related-marquee-section><div id=related-marquee-container></div></section><script defer src=/ext/markdown.js></script><script defer src=/ext/marquee-url.js></script><script defer src=/ext/iposbrowser.js></script><script defer src=/ext/diskus.js></script></html><noscript>schema_oleh_Fakhrul_Rijal_2026-02-23</noscript><noscript>udah_dijepit_oleh_Fakhrul_Rijal_2026-02-23</noscript>