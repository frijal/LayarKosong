<!doctype html><html lang=id prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#"><meta charset=utf-8><meta content="width=device-width,initial-scale=1,maximum-scale=1" name=viewport><title>Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è</title><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai." name=description><link href=/apple-touch-icon.png rel=apple-touch-icon><style>:root{--bg:#0B0F16;--panel:#121826;--text:#E6EAF2;--muted:#A7B0C0;--accent:#6EE7B7;--accent-2:#60A5FA;--danger:#F59E0B;--code-bg:#0F172A;--code-border:#1F2937;--link:#93C5FD;--maxw:1080px}body,html{height:100%;background:radial-gradient(1200px 600px at 60% -10%,#121826 20%,#0b0f16 70%);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";line-height:1.65}a{color:var(--link);text-decoration:none}a:hover{text-decoration:underline}.wrap{display:grid;grid-template-columns:1fr minmax(0,var(--maxw)) 1fr}.content{grid-column:2;padding:24px}header.hero{margin:24px 0 12px;padding:24px;border-radius:18px;background:linear-gradient(180deg,rgba(17,24,39,.7),rgba(17,24,39,.35));border:1px solid rgba(255,255,255,.06)}.title{display:flex;align-items:center;gap:12px;font-size:clamp(1.25rem, 1.6vw + 1rem, 2rem);font-weight:700;letter-spacing:.2px}.title .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(245,158,11,.15);color:var(--danger);font-weight:600;border:1px dashed rgba(245,158,11,.45)}.subtitle{margin-top:10px;color:var(--muted);font-size:.98rem}.actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background:var(--panel);color:var(--text);border:1px solid rgba(255,255,255,.08);cursor:pointer;transition:transform .08s ease,background .2s ease;user-select:none}.btn:hover{transform:translateY(-1px)}.btn:active{transform:translateY(0)}.grid{display:grid;grid-template-columns:1.08fr 0.92fr;gap:16px;margin-top:18px}@media (max-width:980px){.grid{grid-template-columns:1fr}}section.block{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:18px}h2,h3{margin:8px 0 14px;font-weight:700;letter-spacing:.2px}h2{font-size:1.25rem}h3{font-size:1.1rem}.lead{color:var(--muted)}ul{list-style:none;padding:0;margin:0;display:grid;gap:10px}.list>li{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}.code{background:var(--code-bg);border:1px solid var(--code-border);border-radius:14px;overflow:auto;position:relative}pre{margin:0;padding:16px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.95rem;line-height:1.55;color:#d1d5db}.codebar{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.2);border-top-left-radius:14px;border-top-right-radius:14px}.code-actions{display:inline-flex;gap:8px}.note{margin-top:12px;color:var(--muted);font-size:.94rem}footer.site{margin:24px 0;padding:18px;color:var(--muted);font-size:.9rem;border-top:1px dashed rgba(255,255,255,.1)}.share{display:flex;gap:10px;flex-wrap:wrap}.share a{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04)}.share svg{width:18px;height:18px}.kbd{display:inline-block;padding:2px 6px;border-radius:6px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-size:.9rem}.fullscreen{position:fixed;inset:0;z-index:9999;backdrop-filter:blur(2px);padding:24px;background:radial-gradient(1200px 600px at 60% -10%,#121826 20%,#0b0f16 70%);overflow:auto}</style><link href=/ext/marquee-url.css rel=stylesheet><link href=https://dalam.web.id/rss.xml rel=alternate title="30 artikel baru bikin." type=application/rss+xml><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai." name=ai:summary><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai." name=ai:prompt_hint><link href=https://dalam.web.id/warta-tekno/build-deploy-clean-branch/ rel=canonical><link href=/favicon.ico rel=icon><link href=https://creativecommons.org/publicdomain/zero/1.0/ rel=license><meta content="Fakhrul Rijal" name=author><meta content="index, follow, max-image-preview:large" name=robots><meta content=max-image-preview:large name=googlebot><meta content=#00b0ed name=theme-color><meta content=@frijal@mastodon.social name=fediverse:creator><meta content=@responaja name=twitter:creator><meta content=@dalam.web.id name=bluesky:creator><meta content="Layar Kosong" property=og:site_name><meta content=id_ID property=og:locale><meta content=article property=og:type><meta content=https://dalam.web.id/warta-tekno/build-deploy-clean-branch/ property=og:url><meta content="Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è" property=og:title><meta content="Workflow GitHub Actions yang membalik alur: cek perubahan terlebih dulu di daftar file terizinkan, baru jalankan rsync dan deploy ke branch site. Dengan penjelasan santai, opsi logging, dan contoh YAML siap pakai." property=og:description><meta content=summary_large_image name=twitter:card><meta content=@responaja name=twitter:site><meta content=175216696195384 property=fb:app_id><meta content=https://facebook.com/frijal property=article:author><meta content=https://facebook.com/frijalpage property=article:publisher><meta content=https://dalam.web.id/img/build-deploy-clean-branch.webp property=og:image><meta content="Build and Deploy to Clean Branch ‚Äî Alur Dibalik + Cek Perubahan Sebelum rsync ‚ö†Ô∏è" property=og:image:alt><meta content=1200 property=og:image:width><meta content=675 property=og:image:height><meta content=https://dalam.web.id/img/build-deploy-clean-branch.webp name=twitter:image><meta content=https://dalam.web.id/img/build-deploy-clean-branch.webp itemprop=image><div class=wrap><main class=content><header class=hero><div class=title><span class=badge><h1>‚ö†Ô∏è Build and Deploy to Clean Branch</h1></span><span>Alur Dibalik: cek perubahan dulu, baru rsync + deploy</span><div id=iposbrowser></div></div><p class=subtitle>Intinya: sebelum melakukan <span class=kbd>rsync</span> dan deploy, workflow ini membandingkan isi daftar file yang diizinkan dengan versi sebelumnya di branch <span class=kbd>site</span>. Kalau tidak ada perubahan, langkah <span class=kbd>rsync</span> dan deploy dilewati.<div class=actions><button class=btn id=toggleFull>Full screen</button> <button class=btn id=copyTitle>Salin judul</button> <button class=btn id=scrollCode>Lompat ke kode</button></div></header><div class=grid><section class=block><h2>Konsep alur yang dibalik</h2><ul class=list><li>**Inti:** Cek perubahan dulu. Bandingkan hasil seleksi file dari branch <span class=kbd>main</span> dengan isi branch <span class=kbd>site</span>.<li>**Langkah 1:** Checkout <span class=kbd>main</span> sebagai sumber, dan <span class=kbd>site</span> sebagai target.<li>**Langkah 2:** Ekstrak file terizinkan ke direktori sementara (<span class=kbd>deploy_dir</span>).<li>**Langkah 3:** Gunakan <span class=kbd>rsync --dry-run</span> untuk membandingkan <span class=kbd>deploy_dir</span> vs <span class=kbd>site</span>.<li>**Keputusan:** Jika ada perubahan ‚Üí lanjutkan rsync + deploy. Jika tidak ‚Üí skip deploy.</ul><p class=lead>Pendekatan ini menghemat waktu, mengurangi commit ‚Äúkosong‚Äù, dan menjaga branch <span class=kbd>site</span> tetap bersih dan akurat.</section><section class=block><h2>Tips praktis biar workflow makin mantap</h2><ul class=list><li>**Logging:** Simpan hasil perbandingan ke <span class=kbd>diff.log</span> dan upload sebagai artifact agar gampang audit.<li>**Ekstensi file:** Pastikan pola <span class=kbd>--include</span> konsisten dengan kebutuhanmu (HTML, XML, TXT, ikon, manifest).<li>**Kebersihan:** Gunakan <span class=kbd>--delete</span> untuk memastikan target selalu mirror dari sumber terpilih.<li>**Stabilitas:** Tetap pakai <span class=kbd>actions/checkout@v4</span> dua kali: sekali untuk <span class=kbd>main</span>, sekali untuk <span class=kbd>site</span>.<li>**Ekstra aman:** Jika ada build step, jalankan sebelum seleksi file, supaya yang dibandingkan sudah final.</ul></section></div><section class=block id=codeBlock><div class=codebar>**Contoh implementasi (YAML)**<div class=code-actions><button class=btn id=copyCode>Salin kode</button> <button class=btn id=wideCode>Lebarkan area kode</button></div></div><div class=code id=codePane><pre><code>name: ‚ö†Ô∏è Build and Deploy to Clean Branch
on:
  push:
    branches:
      - main
  workflow_dispatch:
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # Checkout branch main (source)
      - name: Checkout source branch
        uses: actions/checkout@v4
        with:
          ref: main
          path: source
      # Checkout branch site (target)
      - name: Checkout site branch
        uses: actions/checkout@v4
        with:
          ref: site
          path: site
      # Buat direktori sementara
      - name: Create clean directory
        run: mkdir deploy_dir
      # Salin hanya file yang diizinkan dari source
      - name: Sync allowed files to deploy directory
        run: |
          rsync -a --delete \
            --include='artikel/***' \
            --include='ext/***' \
            --include='img/***' \
            --include='artikel.json' \
            --include='_redirects' \
            --include='_headers' \
            --include='*.html' \
            --include='*.xml' \
            --include='*.txt' \
            --include='favicon.*' \
            --include='icon.*' \
            --include='logo.*' \
            --include='thumbnail.*' \
            --include='*.webmanifest' \
            --exclude='*' \
            source/ deploy_dir/
      # Bandingkan dengan branch site
      - name: Check for changes
        id: check_changes
        run: |
          rsync -a --dry-run --delete deploy_dir/ site/ > diff.log
          if [ -s diff.log ]; then
            echo "changed=true" >> $GITHUB_OUTPUT
          else
            echo "changed=false" >> $GITHUB_OUTPUT
          fi
      # [Opsional] Upload diff.log untuk audit
      - name: Upload diff artifact
        if: steps.check_changes.outputs.changed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: deploy-diff
          path: diff.log
      # Deploy hanya jika ada perubahan
      - name: Deploy to site branch
        if: steps.check_changes.outputs.changed == 'true'
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy_dir
          publish_branch: site
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          force_orphan: true
</code></pre></div><p class=note>Kalau kamu ingin lebih ketat, tambahkan validasi checksum (misalnya dengan <span class=kbd>sha256sum</span>) untuk mendeteksi perubahan yang halus.</section><section class=block><h2>Penjelasan singkat dan alasan desain</h2><ul class=list><li>**Checkout dua cabang:** Kita butuh snapshot <span class=kbd>main</span> (sumber) dan <span class=kbd>site</span> (target) agar bisa membandingkan keadaan terakhir yang ter-deploy.<li>**Seleksi file:** <span class=kbd>rsync</span> dengan kombinasi <span class=kbd>--include</span>/<span class=kbd>--exclude</span> membuat direktori bersih (<span class=kbd>deploy_dir</span>) berisi hanya file yang ‚Äúdiizinkan‚Äù.<li>**Dry-run:** <span class=kbd>rsync --dry-run --delete</span> menghasilkan daftar perubahan tanpa benar-benar menyalin; jika ada isi <span class=kbd>diff.log</span>, berarti perlu deploy.<li>**Conditional deploy:** Langkah deploy memakai kondisi <span class=kbd>if</span> sehingga hanya berjalan bila ada perbedaan; ini mencegah commit kosong.<li>**Artifact:** Opsi upload <span class=kbd>diff.log</span> membantu audit dan debugging‚Äîpraktis kalau suatu saat hasil tidak sesuai ekspektasi.</ul></section><section class=block><h2>Opsi lanjutan dan penguatan</h2><ul class=list><li>**Proteksi pola:** Simpan pola <span class=kbd>include/exclude</span> di file terpisah (misalnya <span class=kbd>sync.rules</span>) dan panggil dengan <span class=kbd>--filter='merge sync.rules'</span> agar mudah dirawat.<li>**Pre-build:** Jika ada proses build (minify, generate, bundling), jalankan sebelum seleksi agar yang dibandingkan benar-benar output final.<li>**Cache:** Tambah caching untuk dependency build agar job makin cepat, tanpa mengubah mekanisme cek perubahan.<li>**Notifikasi:** Kirim notifikasi (mis. ke Slack) hanya saat <span class=kbd>changed == true</span> supaya tim dapat sinyal relevan.<li>**Keamanan:** Pastikan tidak ada file sensitif yang lolos: validasi dengan skrip audit (regex nama file, ekstensi, path).</ul><div id=pesbukdiskus></div><div id=related-articles-grid></div></section><footer class=site><div style=margin-top:10px>üÑØ 2025 Frijal Docs ‚Äî Artikel DevOps. Canonical: [dalam.web.id/artikel/build-deploy-clean-branch.html](https://dalam.web.id/warta-tekno/build-deploy-clean-branch/.html)</div></footer></main></div><script>!function(){document.querySelector('link[rel="canonical"]')?.href||location.href,document.title,document.querySelector(".wrap");const e=document.querySelector(".content"),t=document.getElementById("toggleFull");let n=!1;t.addEventListener("click",()=>{n=!n,n?(e.classList.add("fullscreen"),t.textContent="Keluar full screen"):(e.classList.remove("fullscreen"),t.textContent="Full screen")}),document.getElementById("scrollCode").addEventListener("click",()=>{document.getElementById("codeBlock").scrollIntoView({behavior:"smooth",block:"start"})});const o=document.querySelector("#codeBlock pre");document.getElementById("copyCode").addEventListener("click",()=>{const e=o.innerText;navigator.clipboard.writeText(e).then(()=>{const e=document.getElementById("copyCode");e.textContent="Kode disalin",setTimeout(()=>e.textContent="Salin kode",1600)})});const c=document.getElementById("codePane"),l=document.getElementById("wideCode");let d=!1;l.addEventListener("click",()=>{d=!d,c.style.maxWidth=d?"none":"",c.style.width=d?"100%":"",l.textContent=d?"Kembalikan lebar":"Lebarkan area kode"})}()</script><div id=progress></div><a href=https://dalam.web.id/ id=layar-kosong-header></a><div class=search-floating-container><input autocomplete=off id=floatingSearchInput placeholder="cari artikel..."><span class=clear-button id=floatingSearchClear></span><div class=floating-results-container id=floatingSearchResults></div></div><div class=floating-nav id=dynamic-nav-container></div><div id=internal-nav></div><section id=related-marquee-section><div id=related-marquee-container></div></section><script defer="" src=/ext/marquee-url.js></script><script defer="" src=/ext/iposbrowser.js></script><script defer="" src=/ext/markdown.js></script><script defer="" src=/ext/pesbukdiskus.js></script>
<noscript>udah_dijepit_oleh_Fakhrul_Rijal_2026-02-05_11_52</noscript>