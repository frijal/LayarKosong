<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Struktur Organisasi YVCI</title>
</head>
  <body>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-org-chart@3.1.0"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.1.2/build/d3-flextree.js"></script>
<div
      class="chart-container"
      style="height: auto; background-color: #fffeff"
    ></div>

    <script>
      var chart;
      d3.csv(
        // Pastikan ini mengarah ke file CSV Anda yang valid
        'https://dalam.web.id/ext/yvciorg/data.csv'
      ).then((dataFlattened) => {
        chart = new d3.OrgChart()
          .container('.chart-container')
          .data(dataFlattened)
          .rootMargin(100)
          .nodeWidth((d) => 380)
          .nodeHeight((d) => 214) // Tinggi node disesuaikan karena baris berkurang
          .childrenMargin((d) => 170)
          .compactMarginBetween((d) => 75)
          .compactMarginPair((d) => 80)
          .linkUpdate(function (d, i, arr) {
            d3.select(this)
              .attr('stroke', (d) =>
                d.data._upToTheRootHighlighted ? '#152785' : 'lightgray'
              )
              .attr('stroke-width', (d) =>
                d.data._upToTheRootHighlighted ? 5 : 1.5
              )
              .attr('stroke-dasharray', '4,4');

            if (d.data._upToTheRootHighlighted) {
              d3.select(this).raise();
            }
          })
          .nodeContent(function (d, i, arr, state) {
            const colors = [
              '#6E6B6F', '#18A8B6', '#F45754', '#96C62C', '#BD7E16', '#802F74',
            ];
            const color = colors[d.depth % colors.length];
            const imageDim = 160;
            const lightCircleDim = 160;
            const outsideCircleDim = 160;

            // Hitung offset yang diperlukan agar semua lingkaran dan gambar berada di tengah
            const imageOffset = (outsideCircleDim - imageDim) / 2;
            const lightCircleOffset = (outsideCircleDim - lightCircleDim) / 2;
            const baseMarginTop = -outsideCircleDim / 2; // -55px

            const rowHeight = 28;
            const smallRowHeight = 20;

            let imageContent = '';
            const imageUrl = d.data.imageUrl;

            if (imageUrl && imageUrl.trim() !== '') {
                 imageContent = `
                    <div style="background-color:${color};position:absolute;
                        margin-top:${baseMarginTop}px;
                        margin-left:${d.width / 2 - outsideCircleDim / 2}px;
                        border-radius:100px;width:${outsideCircleDim}px;height:${outsideCircleDim}px;">
                    </div>

                    <div style="background-color:#ffffff;position:absolute;
                        margin-top:${baseMarginTop + lightCircleOffset}px;
                        margin-left:${d.width / 2 - lightCircleDim / 2}px;
                        border-radius:100px;width:${lightCircleDim}px;height:${lightCircleDim}px;">
                    </div>

                    <img src="${imageUrl}" style="position:absolute;
                        margin-top:${baseMarginTop + imageOffset}px;
                        margin-left:${d.width / 2 - imageDim / 2}px;
                        border-radius:100px;width:${imageDim}px;height:${imageDim}px;
                        object-fit: cover;" />
                 `;
            }

            return `
                <div style="background-color:white; position:absolute;width:${
                  d.width
                }px;height:${d.height}px;">

                    ${imageContent}                                         <div class="card" style="top:${
                     outsideCircleDim / 2 + 10
                   }px;position:absolute;width:${d.width}px; background-color:#3AB6E3;">

                        <div style="background-color:${color};height:${rowHeight}px;text-align:center;padding-top:10px;color:#ffffff;font-weight:bold;font-size:16px">
                            ${d.data.positionName}
                        </div>

                        <div style="background-color:#f6f5f4; height:auto; padding: 5px 10px; color:#424142; font-size:16px; font-weight:bold; overflow: hidden; white-space: nowrap;">
    <div style="float: right; text-align: left; color:#424142;">
        ${d.data.id}
    </div>
    <div style="text-align: left; color: #18A8B6;">
        ${d.data.name}
    </div>
</div>

                        <div style="display: flex; background-color:#D3D3D3;height:${smallRowHeight}px; padding-top:5px; color:#424142; font-size:12px;">
                            <div style="width: 50%; text-align: right; padding-right: 5px;">
                                Chapter: ${d.data.chapter}
                            </div>
                            <div style="width: 50%; text-align: left; padding-left: 5px;">
                                Regional: ${d.data.regional}
                            </div>
                        </div>

                   </div>
               </div>
          `;
          })
           .render();
      });
    </script>
  </body>

</html>
