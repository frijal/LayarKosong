document.addEventListener("DOMContentLoaded",async()=>{let $=document.getElementById("categories");if(!$){console.error("Container #categories tidak ditemukan!");return}let Z=document.createElement("div");Z.style.textAlign="center",Z.style.marginBottom="10px";let K=document.createElement("input");K.type="text",K.placeholder="\uD83D\uDD0D Cari artikel...",K.style.padding="6px 10px",K.style.width="300px",K.style.fontSize="14px",K.style.borderRadius="4px",K.style.border="1px solid #ccc";let V=document.createElement("button");V.textContent="❌",V.style.marginLeft="5px",V.style.padding="6px 10px",V.style.fontSize="14px",V.style.cursor="pointer";let W=document.createElement("button");W.textContent="↩️ Undo",W.style.marginLeft="5px",W.style.padding="6px 10px",W.style.fontSize="14px",W.style.cursor="pointer",Z.appendChild(K),Z.appendChild(V),Z.appendChild(W),$.parentNode.insertBefore(Z,$);let E=document.getElementById("downloadBtn"),f;try{let j=await fetch("../artikel.json");if(!j.ok)throw Error(`HTTP error! status: ${j.status}`);f=await j.json()}catch(j){console.error("Gagal load artikel.json:",j);return}let N=Object.keys(f).map((j)=>{let y=f[j].reduce((q,F)=>{let G=new Date(F[3]);return G>q?G:q},new Date(0));return{name:j,latestDate:y}}).sort((j,y)=>y.latestDate.getTime()-j.latestDate.getTime()).map((j)=>j.name),S=3,L=JSON.parse(JSON.stringify(f)),_=null;function w(j){j.addEventListener("dragstart",(y)=>{if(_=j,y.dataTransfer)y.dataTransfer.effectAllowed="move";setTimeout(()=>j.style.display="none",0)}),j.addEventListener("dragend",()=>{if(_)_.style.display="flex";_=null})}function b(j){j.addEventListener("dragover",(y)=>{if(y.preventDefault(),y.dataTransfer)y.dataTransfer.dropEffect="move"}),j.addEventListener("drop",(y)=>{if(y.preventDefault(),_)j.appendChild(_)})}let A=document.createElement("div");A.id="contextMenu",document.body.appendChild(A);function C(){A.innerHTML="",N.forEach((j)=>{let y=document.createElement("div");y.textContent=j,y.addEventListener("click",()=>{if(A.currentItem){let q=document.querySelector(`.item-list[data-category="${j}"]`);if(q)q.appendChild(A.currentItem);A.currentItem=null}A.style.display="none"}),A.appendChild(y)})}C(),document.addEventListener("click",(j)=>{if(!A.contains(j.target))A.style.display="none"});function B(j){j.addEventListener("contextmenu",(y)=>{y.preventDefault(),A.currentItem=j,A.style.left=y.pageX+"px",A.style.top=y.pageY+"px",A.style.display="block"})}function T(j){$.innerHTML="";let y=Array.from({length:S},()=>{let q=document.createElement("div");return q.className="column",q.style.minWidth="250px",q.style.margin="0 10px",$.appendChild(q),q});N.forEach((q,F)=>{let G=y[F%S],P=document.createElement("details");P.className="category",P.dataset.category=q,P.open=!0;let H=document.createElement("summary"),X=j[q]?j[q].length:0;H.textContent=`${q} (${X})`,P.appendChild(H);let Q=document.createElement("div");if(Q.className="item-list",Q.dataset.category=q,j[q])[...j[q]].sort((O,J)=>new Date(J[3]).getTime()-new Date(O[3]).getTime()).forEach((O)=>{let[J,I,k,M,h]=O,z=document.createElement("div");z.className="item",z.draggable=!0,z.dataset.file=I,z.dataset.image=k,z.dataset.lastmod=M,z.dataset.description=h,z.style.padding="8px",z.style.marginBottom="5px",z.style.borderBottom="1px solid #eee",z.style.display="flex",z.style.alignItems="center",z.style.gap="10px";let Y=document.createElement("img");Y.src=k,Y.alt=J,Y.style.width="40px",Y.style.height="40px",Y.style.objectFit="cover",Y.style.borderRadius="4px";let R=document.createElement("span");R.textContent=J,R.style.fontSize="13px",z.appendChild(Y),z.appendChild(R),w(z),B(z),Q.appendChild(z)});P.appendChild(Q),G.appendChild(P),b(Q)})}if(T(f),E)E.addEventListener("click",()=>{let j={};document.querySelectorAll(".category").forEach((G)=>{let P=G.dataset.category||"Uncategorized",H=[];G.querySelectorAll(".item").forEach((X)=>{let Q=X.querySelector("span");H.push([Q?Q.textContent||"":"",X.dataset.file||"",X.dataset.image||"",X.dataset.lastmod||"",X.dataset.description||""])}),j[P]=H});let y=new Blob([JSON.stringify(j,null,2)],{type:"application/json"}),q=URL.createObjectURL(y),F=document.createElement("a");F.href=q,F.download="artikel.json",F.click(),URL.revokeObjectURL(q)});function U(j){let y=new RegExp(`(${j})`,"gi");document.querySelectorAll(".item").forEach((q)=>{let F=q.querySelector("span"),G=F.dataset.original||F.textContent||"";if(!F.dataset.original)F.dataset.original=G;if(!j)F.innerHTML=G,q.style.display="flex";else if(G.toLowerCase().includes(j.toLowerCase()))F.innerHTML=G.replace(y,"<mark>$1</mark>"),q.style.display="flex";else q.style.display="none"})}K.addEventListener("input",(j)=>U(j.target.value)),V.addEventListener("click",()=>{K.value="",U("")}),W.addEventListener("click",()=>T(L))});
