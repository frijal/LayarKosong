document.addEventListener("DOMContentLoaded",async()=>{let Z=document.getElementById("categories"),_=document.createElement("div");_.style.textAlign="center",_.style.marginBottom="10px";let Q=document.createElement("input");Q.type="text",Q.placeholder="\uD83D\uDD0D Cari artikel...",Q.style.padding="6px 10px",Q.style.width="300px",Q.style.fontSize="14px",Q.style.borderRadius="4px",Q.style.border="1px solid #ccc";let V=document.createElement("button");V.textContent="❌",V.style.marginLeft="5px",V.style.padding="6px 10px",V.style.fontSize="14px",V.style.cursor="pointer";let W=document.createElement("button");W.textContent="↩️ Undo",W.style.marginLeft="5px",W.style.padding="6px 10px",W.style.fontSize="14px",W.style.cursor="pointer",_.appendChild(Q),_.appendChild(V),_.appendChild(W),Z.parentNode.insertBefore(_,Z);let S=document.getElementById("downloadBtn");if(!Z){console.error("Container #categories tidak ditemukan!");return}let $;try{let j=await fetch("../artikel.json");if(!j.ok)throw Error(`HTTP error! status: ${j.status}`);$=await j.json()}catch(j){console.error("Gagal load artikel.json:",j);return}let E=Object.keys($).map((j)=>{let z=$[j].reduce((q,G)=>{let K=new Date(G[3]);return K>q?K:q},new Date(0));return{name:j,latestDate:z}}).sort((j,z)=>z.latestDate-j.latestDate).map((j)=>j.name),O=3,h=Array.from({length:O},()=>{let j=document.createElement("div");return j.className="column",Z.appendChild(j),j}),k=JSON.parse(JSON.stringify($)),f=null;function w(j){j.addEventListener("dragstart",(z)=>{f=j,z.dataTransfer.effectAllowed="move",setTimeout(()=>j.style.display="none",0)}),j.addEventListener("dragend",()=>{f.style.display="flex",f=null})}function b(j){j.addEventListener("dragover",(z)=>{z.preventDefault(),z.dataTransfer.dropEffect="move"}),j.addEventListener("drop",(z)=>{if(z.preventDefault(),f)j.appendChild(f)})}let F=document.createElement("div");F.id="contextMenu",document.body.appendChild(F);function C(){F.innerHTML="",E.forEach((j)=>{let z=document.createElement("div");z.textContent=j,z.addEventListener("click",()=>{if(F.currentItem){let q=document.querySelector(`.item-list[data-category="${j}"]`);if(q)q.appendChild(F.currentItem);F.currentItem=null}F.style.display="none"}),F.appendChild(z)})}C(),document.addEventListener("click",(j)=>{if(!F.contains(j.target))F.style.display="none"});function B(j){j.addEventListener("contextmenu",(z)=>{z.preventDefault(),F.currentItem=j,F.style.left=z.pageX+"px",F.style.top=z.pageY+"px",F.style.display="block"})}function L(j){Z.innerHTML="";let z=Array.from({length:O},()=>{let q=document.createElement("div");return q.className="column",q.style.minWidth="250px",q.style.margin="0 10px",Z.appendChild(q),q});E.forEach((q,G)=>{let K=z[G%O],R=document.createElement("details");R.className="category",R.dataset.category=q,R.open=!0;let y=document.createElement("summary"),X=j[q]?j[q].length:0;y.textContent=`${q} (${X})`,R.appendChild(y);let H=document.createElement("div");H.className="item-list",H.dataset.category=q,j[q].slice().sort((P,J)=>new Date(J[3])-new Date(P[3])).forEach((P)=>{let[J,I,T,M,p]=P,A=document.createElement("div");A.className="item",A.draggable=!0,A.dataset.file=I,A.dataset.image=T,A.dataset.lastmod=M,A.dataset.description=p,A.style.padding="8px",A.style.marginBottom="5px",A.style.borderBottom="1px solid #eee",A.style.display="flex",A.style.alignItems="center",A.style.gap="10px";let Y=document.createElement("img");Y.src=T,Y.alt=J,Y.style.width="40px",Y.style.height="40px",Y.style.objectFit="cover",Y.style.borderRadius="4px";let U=document.createElement("span");U.textContent=J,U.style.fontSize="13px",A.appendChild(Y),A.appendChild(U),w(A),B(A),H.appendChild(A)}),R.appendChild(H),K.appendChild(R),b(H)})}L($),S.addEventListener("click",()=>{let j={};document.querySelectorAll(".category").forEach((K)=>{let R=K.dataset.category,y=[];K.querySelectorAll(".item").forEach((X)=>{y.push([X.querySelector("span").textContent,X.dataset.file,X.dataset.image,X.dataset.lastmod,X.dataset.description])}),j[R]=y});let z=new Blob([JSON.stringify(j,null,2)],{type:"application/json"}),q=URL.createObjectURL(z),G=document.createElement("a");G.href=q,G.download="artikel.json",G.click(),URL.revokeObjectURL(q)});function N(j){let z=new RegExp(`(${j})`,"gi");document.querySelectorAll(".item").forEach((q)=>{let G=q.querySelector("span"),K=G.dataset.original||G.textContent;if(G.dataset.original=K,!j)G.innerHTML=K,q.style.display="flex";else if(K.toLowerCase().includes(j.toLowerCase()))G.innerHTML=K.replace(z,"<mark>$1</mark>"),q.style.display="flex";else q.style.display="none"})}Q.addEventListener("input",(j)=>N(j.target.value)),V.addEventListener("click",()=>{Q.value="",N("")}),W.addEventListener("click",()=>L(k))});
